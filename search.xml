<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>定时任务</title>
    <url>/2020/01/02/05-linux-Linux%20%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1/</url>
    <content><![CDATA[<h3 id="4-1-系统定时任务"><a href="#4-1-系统定时任务" class="headerlink" title="4.1 系统定时任务"></a>4.1 系统定时任务</h3><h4 id="4-1-1-定时任务服务程序初识"><a href="#4-1-1-定时任务服务程序初识" class="headerlink" title="4.1.1 定时任务服务程序初识"></a>4.1.1 定时任务服务程序初识</h4><ol>
<li>作用：让指定任务可以在规定时间由系统自动执行</li>
<li>应用<ol>
<li>系统重要数据信息备份</li>
<li>系统信息做监控管理</li>
<li>系统日志切割功能</li>
</ol>
</li>
</ol>
<h4 id="4-1-2-定时任务实现方式"><a href="#4-1-2-定时任务实现方式" class="headerlink" title="4.1.2 定时任务实现方式"></a>4.1.2 定时任务实现方式</h4><ol>
<li><p>三种方式：</p>
<ol>
<li><p>按照定义时间完成任务：cronie定时任务软件</p>
</li>
<li><p>按照规定周期完成任务(小时、天、周、月)：anacron定时任务软件</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ll /etc/cron* -d</span><br><span class="line">输出：</span><br><span class="line">drwxr-xr-x. 2 root root  21 Nov  9 12:11 /etc/cron.d</span><br><span class="line">drwxr-xr-x. 2 root root  57 Nov 27 19:28 /etc/cron.daily <span class="comment"># 该目录下的文件按天执行</span></span><br><span class="line">-rw-------. 1 root root   0 Apr 11  2018 /etc/cron.deny</span><br><span class="line">drwxr-xr-x. 2 root root  22 Nov  9 12:11 /etc/cron.hourly <span class="comment"># 该目录下的文件按小时执行</span></span><br><span class="line">drwxr-xr-x. 2 root root   6 Jun 10  2014 /etc/cron.monthly <span class="comment"># 该目录下的文件按月执行</span></span><br><span class="line">-rw-r--r--. 1 root root 451 Jun 10  2014 /etc/crontab</span><br><span class="line">drwxr-xr-x. 2 root root   6 Jun 10  2014 /etc/cron.weekly <span class="comment"># 该目录下的文件按周执行</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>定义任务后只执行一次：atd定时任务软件</p>
</li>
</ol>
</li>
<li><p>拓展：</p>
<ol>
<li>查看系统软件是否存在 → <code>rpm -qa cronie</code></li>
<li>查看软件部署后在系统中生成了哪些数据 → <code>rpm -ql cronie</code></li>
<li>查看某个服务软件的配置文件 → <code>rpm -qc cronie</code></li>
<li>查看某个命令属于哪个服务程序 → <code>rpm -qf /usr/sbin/crond</code></li>
</ol>
</li>
</ol>
<h4 id="4-1-3-定时任务安装部署"><a href="#4-1-3-定时任务安装部署" class="headerlink" title="4.1.3 定时任务安装部署"></a>4.1.3 定时任务安装部署</h4><ol>
<li>yum安装软件程序：<code>yum install -y cronie</code></li>
<li>启动服务程序：<code>systemctl start crond</code>、<code>systemctl enable crond</code></li>
<li>PS：该服务配置文件修改后，不需要重启服务</li>
</ol>
<h4 id="4-1-4-定时任务配置方法"><a href="#4-1-4-定时任务配置方法" class="headerlink" title="4.1.4 定时任务配置方法"></a>4.1.4 定时任务配置方法</h4><ol>
<li><p>一个命令(<code>crontab</code>)，两个文件</p>
</li>
<li><p>crontab的用法</p>
<ol>
<li><code>crontab -l</code>：显示当前定时任务配置信息</li>
<li><code>crontab -e</code>：可以实现编辑定时任务，相当于编辑<code>/var/spool/cron/root</code></li>
<li><code>crontab -u root -e</code>：以root用户身份配置定时任务</li>
</ol>
</li>
<li><p>配置文件：<code>/var/spool/cron/root</code></p>
</li>
<li><p>日志文件：<code>/var/log/cron</code></p>
</li>
<li><p>设置定时任务方法</p>
<ol>
<li><p>时间设定</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat /etc/cron</span><br><span class="line">=========================================</span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br><span class="line">=========================================</span><br><span class="line">时间符号设置：</span><br><span class="line">*             代表每，例如 10 * * * * 代表每到10分钟的时候执行</span><br><span class="line">n,m        指定不连续的时间执行定时任务</span><br><span class="line">n-m        指定连续的时间执行定时任务</span><br><span class="line">*/n           每隔多久执行定时任务，会按照时间的整数倍执行，例如(00 */2 * * *) → 0-23中可以整除2的时间执行(0,2,4,6, ... 22)</span><br><span class="line">=========================================</span><br><span class="line">PS：时间之间有或者关系</span><br><span class="line">PS：大的时间确认之后，小的时间也需要确认</span><br><span class="line">=========================================</span><br><span class="line">crontab -e</span><br><span class="line">* * * * * <span class="built_in">echo</span> <span class="string">&quot;12345&quot;</span> &gt;&gt; /tmp/cron_test     <span class="comment"># 先写五个星号*，分别代表分时日月周</span></span><br><span class="line">10 * * * * <span class="built_in">echo</span> <span class="string">&quot;12345&quot;</span> &gt;&gt; /tmp/cron_test     <span class="comment"># 每天每小时的10分的时候执行</span></span><br><span class="line">00 09,12,14 * * * <span class="built_in">echo</span> <span class="string">&quot;12345&quot;</span> &gt;&gt; /tmp/cron_test     <span class="comment"># 每天的09:00，12:00，14:00执行</span></span><br><span class="line">00 09-11 * * * <span class="built_in">echo</span> <span class="string">&quot;12345&quot;</span> &gt;&gt; /tmp/cron_test     <span class="comment"># 每天的09:00，10:00，11:00执行</span></span><br><span class="line">00 */2 * * * <span class="built_in">echo</span> <span class="string">&quot;12345&quot;</span> &gt;&gt; /tmp/cron_test     <span class="comment"># 每隔两小时执行</span></span><br><span class="line">=========================================</span><br><span class="line">练习</span><br><span class="line">01. 每天12点执行定时任务：00 12 * * *</span><br><span class="line">02. 每天12,15,16点执行：00 12,15,16 * * *</span><br><span class="line">03. 每周五晚上10点执行任务：00 22 * * 5</span><br><span class="line">05. 每月5号执行定时任务：00 00 5 * *</span><br><span class="line">06. 每月10号周五执行定时任务：00 00 10 * 5     → 无意义</span><br></pre></td></tr></table></figure>
</li>
<li><p>任务设定(命令)</p>
</li>
</ol>
</li>
</ol>
<h4 id="4-1-5-定时任务编写注意事项"><a href="#4-1-5-定时任务编写注意事项" class="headerlink" title="4.1.5 定时任务编写注意事项"></a>4.1.5 定时任务编写注意事项</h4><ol>
<li>编写定时任务时，写好注释信息</li>
<li>当执行定时任务有多步操作时，最好编写为脚本文件执行定时任务</li>
<li>定时任务中的命令信息最好使用绝对路径执行<ol>
<li>执行操作命令原理<ol>
<li>判断某个命令是否是别名</li>
<li>是则读取别名对应的命令信息；否则继续判断环境变量路径中是否有命令文件</li>
<li>PATH找到则执行命令，没找到则命令无法找到</li>
</ol>
</li>
<li>定时任务中执行 <code>$PATH = /usr/bin/:bin</code></li>
</ol>
</li>
<li>将命令产生的输出信息最好追加到空或者取消默认输出<ol>
<li><code>/var/spool/mail/</code>：系统输出的一些信息(接收定时任务中命令输出信息)会保存到该目录下对应用户的文件中</li>
<li>该目录下文件会不断变大，解决方案有二：<ol>
<li>关闭该服务：<code>systemctl stop postfix.service</code>，会将输出信息放到别的文件中(<code>/var/spool/postfix/maildrop/</code>此目录下会生成大量的小文件 → inode 不足)</li>
<li><code>&gt; /dev/null</code>：追加到空(黑洞，该文件是字符流文件)<ol>
<li><code>echo 12345 1&gt; /dev/null 2&gt; dev/null</code>：同时将错误和正确信息输出到一个文件中</li>
<li><code>echo 12345 &amp;&gt; /dev/null</code>，同上</li>
<li><code>echo 12345 &gt; /dev/null 2&gt;&amp;1 </code>，同上</li>
<li><code>1&gt; 或者 &gt;</code>：标准输出重定向符号，将命令执行后的正确信息输出到指定文件中</li>
<li><code>2&gt;</code>：错误输出重定向符号，将命令执行后的错误信息输出到指定文件中(例如命令写错等)</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>尽量不要出现特殊符号</li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/01/02/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>others</category>
      </categories>
  </entry>
</search>
